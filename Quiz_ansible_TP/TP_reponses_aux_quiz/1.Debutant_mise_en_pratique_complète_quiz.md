# ğŸš€ Mise en pratique complÃ¨te Ansible : Nginx + Users + Fichiers + RÃ´les + Vault + ansible-lint

## ğŸ¯ Objectif
Un projet fil rouge Ã©volutif pour acquÃ©rir un socle solide de bonnes pratiques Ansible, de niveau 0 (dÃ©butant) Ã  10 (proche intermÃ©diaire).

---

## ğŸ—‚ï¸ Plan de la pratique (Steps 0 â†’ 10)

- ğŸ› ï¸ **Step 1** : Mise en place du projet propre (arborescence, ansible.cfg, inventaire)
- ğŸ“¦ **Step 2** : Playbook simple Nginx (modules dÃ©diÃ©s, idempotence)
- ğŸ‘¥ **Step 3** : Ajout gestion users + fichiers (avec bonnes pratiques)
- ğŸ§© **Step 4** : Passage aux rÃ´les (`webserver_role` + `users_role`) + group_vars
- ğŸ” **Step 5** : IntÃ©gration Vault + ansible-lint + check-mode + tags

---

## ğŸ“ Step 1 â€“ CrÃ©ation du projet propre (niveau 0â€“2)

âœ¨ *But : partir sur une structure propre dÃ¨s le dÃ©but.*

```

mkdir -p ~/ansible-nginx-lab/{inventories/dev,playbooks,roles,group_vars}
cd ~/ansible-nginx-lab

```

**ansible.cfg** :

```

[defaults]
inventory = inventories/dev/hosts.ini
host_key_checking = False
retry_files_enabled = False
interpreter_python = auto_silent
roles_path = roles

```

**inventories/dev/hosts.ini** :

```

[webservers]
localhost ansible_connection=local

```

âœ… **Test basique** :
```

ansible webservers -m ansible.builtin.ping

```

---

## ğŸ“¦ Step 2 â€“ Premier playbook Nginx simple (niveau 2â€“4)

âœ¨ *But : Installer Nginx proprement, de faÃ§on idempotente avec become.*

**playbooks/deploy_nginx.yml** :

```
---
- name: Deploy Nginx Web Server
  hosts: webservers
  become: true
  tasks:
    - name: Install Nginx
      ansible.builtin.apt:
        name: nginx
        state: present
        update_cache: true

    - name: DÃ©marrer Nginx
      ansible.builtin.service:
        name: nginx
        state: started
        enabled: true

```

ğŸ› ï¸ **ExÃ©cution** :
```

ansible-playbook playbooks/deploy_nginx.yml --ask-become-pass

```

ğŸ”„ **Idempotence** : Relance la commande, la 2e fois tu dois voir `changed=0`.

---

## ğŸ‘¥ Step 3 â€“ Ajout users + fichiers (niveau 3â€“6)

âœ¨ *But : Couvrir modules `user`, `file`, `template` et gÃ©rer permissions avec soin.*

**playbooks/deploy_nginx.yml** mis Ã  jour :

```


***
- name: DÃ©ployer Nginx + users + fichiers
hosts: webservers
become: true

tasks:
    - name: CrÃ©er utilisateur deploy
ansible.builtin.user:
name: deploy
shell: /bin/bash
state: present
    - name: CrÃ©er rÃ©pertoire web principal
ansible.builtin.file:
path: /var/www/myapp
state: directory
owner: deploy
group: deploy
mode: "0755"
    - name: Installer nginx
ansible.builtin.apt:
name: nginx
state: present
update_cache: true
    - name: DÃ©marrer et activer nginx
ansible.builtin.service:
name: nginx
state: started
enabled: true
    - name: DÃ©ployer page index statique
ansible.builtin.copy:
src: files/index.html
dest: /var/www/myapp/index.html
owner: deploy
group: deploy
mode: "0644"

```

ğŸ“‚ **CrÃ©e le dossier files/** :
```

mkdir -p files

```

**files/index.html** :

```

<!doctype html>

<html>
  <body>
    <h1>Hello from Ansible beginner project</h1>
  </body>
</html>
```

âœ… **VÃ©rifications** :
- `getent passwd deploy`
- `ls -la /var/www/myapp/`

---

## ğŸ§© Step 4 â€“ Passage en rÃ´les (web + users) (niveau 5â€“8)

âœ¨ *But : meilleur dÃ©coupage (=meilleure maintenabilitÃ©) avec rÃ´les et group_vars*

ğŸš€ **CrÃ©er les rÃ´les** :

```

mkdir -p roles/webserver_role/{tasks,handlers,templates}
mkdir -p roles/users_role/tasks

```

**roles/users_role/tasks/main.yml** :

```


***
- name: CrÃ©er l'utilisateur deploy
ansible.builtin.user:
name: deploy
shell: /bin/bash
state: present

```

**roles/webserver_role/tasks/main.yml** :

```


***
- name: Installer nginx
ansible.builtin.apt:
name: nginx
state: present
update_cache: true
- name: CrÃ©er rÃ©pertoire web principal
ansible.builtin.file:
path: /var/www/myapp
state: directory
owner: deploy
group: deploy
mode: "0755"
- name: DÃ©ployer page index via template
ansible.builtin.template:
src: index.html.j2
dest: /var/www/myapp/index.html
owner: deploy
group: deploy
mode: "0644"
notify: Restart nginx
- name: DÃ©marrer et activer nginx
ansible.builtin.service:
name: nginx
state: started
enabled: true

```

**roles/webserver_role/handlers/main.yml** :

```


***
- name: Restart nginx
ansible.builtin.service:
name: nginx
state: restarted

```

**roles/webserver_role/templates/index.html.j2** :

```

<!doctype html>

<html>
  <body>
    <h1>{{ site_title }}</h1>
    <p>Serveur : {{ inventory_hostname }}</p>
  </body>
</html>
```

ğŸ“Š **Variables group_vars** :

```

mkdir -p group_vars

```

**group_vars/webservers.yml** :

```

site_title: "Mon site gÃ©rÃ© par Ansible (niveau dÃ©butant++)"

```

ğŸ¯ **Playbook principal playbooks/site.yml** :

```


***
- name: Projet Nginx + users + fichiers via rÃ´les
hosts: webservers
become: true

roles:
    - users_role
    - webserver_role

```

ğŸ› ï¸ **Test** :
```

ansible-playbook playbooks/site.yml --ask-become-pass

```

---

## ğŸ” Step 5 â€“ Vault + ansible-lint + check-mode + tags (niveau 8â€“10)

âœ¨ *But : socle plus "pro" : secrets, vÃ©rification qualitÃ©, exÃ©cution fine*

### 1. ğŸ”’ Ajouter un secret chiffrÃ©

```

ansible-vault create group_vars/all_vault.yml

```

**group_vars/all_vault.yml** (une fois ouvert) :

```

db_password: "super-secret-password"

```

â¯ï¸ **Relancer avec Vault** :

```

ansible-playbook playbooks/site.yml --ask-become-pass --ask-vault-pass

```

### 2. ğŸ·ï¸ Ajouter des tags

**roles/users_role/tasks/main.yml** :

```

- name: CrÃ©er l'utilisateur deploy
ansible.builtin.user:
name: deploy
shell: /bin/bash
state: present
tags: users

```

**roles/webserver_role/tasks/main.yml** (extrait) :

```

- name: Installer nginx
ansible.builtin.apt:
name: nginx
state: present
update_cache: true
tags: nginx

```

â¯ï¸ **Lancer uniquement nginx** :

```

ansible-playbook playbooks/site.yml --tags nginx --ask-become-pass --ask-vault-pass

```

### 3. ğŸ” Check-mode (simulation)

```

ansible-playbook playbooks/site.yml --check --ask-become-pass --ask-vault-pass

```

### 4. ğŸ§¹ ansible-lint (qualitÃ©)

```

ansible-lint playbooks/site.yml

```

Corrige les erreurs signalÃ©es (permissions, FQCN, etc.).

---

## ğŸ† Socle acquis

Avec ce projet, tu as pratiquÃ© sur un cas concret :

âœ… **Structure** : ansible.cfg, inventories, playbooks, roles, group_vars  
âœ… **Modules** : apt, service, user, file, copy, template  
âœ… **Idempotence** : relances sans effet de bord  
âœ… **Architecture** : rÃ´les sÃ©parÃ©s (users_role, webserver_role)  
âœ… **Dynamique** : handlers, templates, group_vars  
âœ… **SÃ©curitÃ©** : Vault pour secrets  
âœ… **ContrÃ´le** : Tags, check-mode  
âœ… **QualitÃ©** : ansible-lint pour bonnes pratiques  

---

## â“ Question de validation

**Quel fichier contient ta variable `site_title` ?**  
**Dans quel template (ou tÃ¢che) l'utilises-tu ?**

---

<div align="center">ğŸ¯ PrÃªt pour la suite ou un rappel sur un point ?</div>
```

Les icÃ´nes Unicode (ğŸš€, ğŸ¯, ğŸ› ï¸, etc.) fonctionnent parfaitement sur GitHub, VSCode, et la plupart des Ã©diteurs Markdown modernes !
<span style="display:none">[^1][^10][^2][^3][^4][^5][^6][^7][^8][^9]</span>

<div align="center">â‚</div>

[^1]: https://gist.github.com/rxaviers/7360908

[^2]: https://gist.github.com/b9b87a2257ddd5251a45628d61385717

[^3]: https://github.com/MadLittleMods/markdown-icons

[^4]: https://dev.to/nikolab/complete-list-of-github-markdown-emoji-markup-5aia

[^5]: https://discuss.streamlit.io/t/is-adding-github-icon-possible-in-markdown/8593

[^6]: https://stackoverflow.com/questions/47344571/how-to-draw-checkbox-or-tick-mark-in-github-markdown-table

[^7]: https://plugins.jetbrains.com/plugin/20705-github-markdown-emojis/versions/stable/898555

[^8]: https://github.com/ikatyang/emoji-cheat-sheet

[^9]: https://jimit105.github.io/github-emoji-cheatsheet/

[^10]: https://gist.github.com/468c0a0a6c854ed5780a32deb73d457f

